<!DOCTYPE html><!--[if lte IE 8]>
<html lang="en" class="lte-ie8">
<![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en">
<!--<![endif]--><head><meta charset="utf-8"><title>January 4, 2016</title><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="/diary/css/global.css"><link rel="stylesheet" href="/diary/css/tomorrow.css"><link rel="stylesheet" href="/diary/css/diary.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-63818301-1', 'auto');
ga('send', 'pageview');</script></head><body><header class="header"><div class="index"><a href="/diary/">Index</a></div><h1>January 4, 2016</h1></header><div class="content"><div class="diary"><h1 id="-7-essential-javascript-functions-1-"><a href="https://davidwalsh.name/essential-javascript-functions?utm_source=javascriptweekly&amp;utm_medium=email">7 Essential JavaScript Functions</a></h1>
<p><code>Frontend</code></p>
<hr>
<p>频繁执行DOM操作、资源加载等重行为，导致UI停顿甚至浏览器崩溃。
1.debounce<br>改变事件引发时的性能。当调用动作n毫秒后，才会执行该动作，若在这n毫秒内又调用此动作则将重新计算执行时间。  </p>
<pre><code><span class="hljs-comment">// Returns a function, that, as long as it continues to be invoked, will not</span>
<span class="hljs-comment">// be triggered. The function will be called after it stops being called for</span>
<span class="hljs-comment">// N milliseconds. If `immediate` is passed, trigger the function on the</span>
<span class="hljs-comment">// leading edge, instead of the trailing.</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debounce</span>(<span class="hljs-params">func, wait, immediate</span>) </span>{
    <span class="hljs-keyword">var</span> timeout;
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">this</span>, args = <span class="hljs-built_in">arguments</span>;
        <span class="hljs-keyword">var</span> later = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            timeout = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">if</span> (!immediate) func.apply(context, args);
        };
        <span class="hljs-keyword">var</span> callNow = immediate &amp;&amp; !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        <span class="hljs-keyword">if</span> (callNow) func.apply(context, args);
    };
};

<span class="hljs-comment">// Usage</span>
<span class="hljs-keyword">var</span> myEfficientFn = debounce(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// All the taxing stuff you do</span>
}, <span class="hljs-number">250</span>);
<span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'resize'</span>, myEfficientFn);
</code></pre><p>2.once<br>给功能只发生一次,类似于你使用onload事件。</p>
<pre><code>function once(fn, context) { 
    <span class="hljs-keyword">var</span> <span class="hljs-literal">result</span>;

    <span class="hljs-keyword">return</span> function() { 
        <span class="hljs-keyword">if</span>(fn) {
            <span class="hljs-literal">result</span> = fn.apply(context || this, arguments);
            fn = null;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">result</span>;
    };
}

// <span class="hljs-type">Usage</span>
<span class="hljs-keyword">var</span> canOnlyFireOnce = once(function() {
    console.log('<span class="hljs-type">Fired</span>!');
});

canOnlyFireOnce(); // <span class="hljs-string">"Fired!"</span>
canOnlyFireOnce(); // nada
</code></pre><p>3.getAbsoluteUrl
获取地址栏地址：  </p>
<pre><code><span class="hljs-keyword">var</span> getAbsoluteUrl = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> a;

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">url</span>) </span>{
        <span class="hljs-keyword">if</span>(!a) a = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'a'</span>);
        a.href = url;

        <span class="hljs-keyword">return</span> a.href;
    };
})();

<span class="hljs-comment">// Usage</span>
getAbsoluteUrl(<span class="hljs-string">'/something'</span>); <span class="hljs-comment">// http://davidwalsh.name/something</span>
</code></pre><p>4.isNative<br>知道如果一个给定的函数是否本地如果你愿意可以覆盖它。  </p>
<pre><code>;(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

  <span class="hljs-comment">// Used to resolve the internal `[[Class]]` of values</span>
  <span class="hljs-keyword">var</span> toString = <span class="hljs-built_in">Object</span>.prototype.toString;

  <span class="hljs-comment">// Used to resolve the decompiled source of functions</span>
  <span class="hljs-keyword">var</span> fnToString = <span class="hljs-built_in">Function</span>.prototype.toString;

  <span class="hljs-comment">// Used to detect host constructors (Safari &gt; 4; really typed array specific)</span>
  <span class="hljs-keyword">var</span> reHostCtor = <span class="hljs-regexp">/^\[object .+?Constructor\]$/</span>;

  <span class="hljs-comment">// Compile a regexp using a common native method as a template.</span>
  <span class="hljs-comment">// We chose `Object#toString` because there's a good chance it is not being mucked with.</span>
  <span class="hljs-keyword">var</span> reNative = <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">'^'</span> +
    <span class="hljs-comment">// Coerce `Object#toString` to a string</span>
    <span class="hljs-built_in">String</span>(toString)
    <span class="hljs-comment">// Escape any special regexp characters</span>
    .replace(<span class="hljs-regexp">/[.*+?^${}()|[\]\/\\]/g</span>, <span class="hljs-string">'\\$&amp;'</span>)
    <span class="hljs-comment">// Replace mentions of `toString` with `.*?` to keep the template generic.</span>
    <span class="hljs-comment">// Replace thing like `for ...` to support environments like Rhino which add extra info</span>
    <span class="hljs-comment">// such as method arity.</span>
    .replace(<span class="hljs-regexp">/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g</span>, <span class="hljs-string">'$1.*?'</span>) + <span class="hljs-string">'$'</span>
  );

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isNative</span>(<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">var</span> type = <span class="hljs-keyword">typeof</span> value;
    <span class="hljs-keyword">return</span> type == <span class="hljs-string">'function'</span>
      <span class="hljs-comment">// Use `Function#toString` to bypass the value's own `toString` method</span>
      <span class="hljs-comment">// and avoid being faked out.</span>
      ? reNative.test(fnToString.call(value))
      <span class="hljs-comment">// Fallback to a host object check because some environments will represent</span>
      <span class="hljs-comment">// things like typed arrays as DOM methods which may not conform to the</span>
      <span class="hljs-comment">// normal native pattern.</span>
      : (value &amp;&amp; type == <span class="hljs-string">'object'</span> &amp;&amp; reHostCtor.test(toString.call(value))) || <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">// export however you want</span>
  <span class="hljs-built_in">module</span>.exports = isNative;
}());

<span class="hljs-comment">// Usage</span>
isNative(alert); <span class="hljs-comment">// true</span>
isNative(myCustomFunction); <span class="hljs-comment">// false</span>
</code></pre><p>5.insertRule<br>设置样式选择器</p>
<pre><code><span class="hljs-keyword">var</span> sheet = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// Create the &lt;style&gt; tag</span>
    <span class="hljs-keyword">var</span> style = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'style'</span>);

    <span class="hljs-comment">// Add a media (and/or media query) here if you'd like!</span>
    <span class="hljs-comment">// style.setAttribute('media', 'screen')</span>
    <span class="hljs-comment">// style.setAttribute('media', 'only screen and (max-width : 1024px)')</span>

    <span class="hljs-comment">// WebKit hack :(</span>
    style.appendChild(<span class="hljs-built_in">document</span>.createTextNode(<span class="hljs-string">''</span>));

    <span class="hljs-comment">// Add the &lt;style&gt; element to the page</span>
    <span class="hljs-built_in">document</span>.head.appendChild(style);

    <span class="hljs-keyword">return</span> style.sheet;
})();

<span class="hljs-comment">// Usage</span>
sheet.insertRule(<span class="hljs-string">"header { float: left; opacity: 0.8; }"</span>, <span class="hljs-number">1</span>);
</code></pre><p>6.matchesSelector 
验证输入;确保真实性,确保表单数据是有效的,等等。</p>
<pre><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">matchesSelector</span>(<span class="hljs-params">el, selector</span>) </span>{
    <span class="hljs-keyword">var</span> p = Element.prototype;
    <span class="hljs-keyword">var</span> f = p.matches || p.webkitMatchesSelector || p.mozMatchesSelector || p.msMatchesSelector || <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">s</span>) </span>{
        <span class="hljs-keyword">return</span> [].indexOf.call(<span class="hljs-built_in">document</span>.querySelectorAll(s), <span class="hljs-keyword">this</span>) !== -<span class="hljs-number">1</span>;
    };
    <span class="hljs-keyword">return</span> f.call(el, selector);
}

<span class="hljs-comment">// Usage</span>
matchesSelector(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'myDiv'</span>), <span class="hljs-string">'div.someSelector[some-attribute=true]'</span>)
</code></pre><p>7.poll  </p>
<pre><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">poll</span>(<span class="hljs-params">fn, callback, errback, timeout, interval</span>) </span>{
    <span class="hljs-keyword">var</span> endTime = <span class="hljs-built_in">Number</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()) + (timeout || <span class="hljs-number">2000</span>);
    interval = interval || <span class="hljs-number">100</span>;

    (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">p</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-comment">// If the condition is met, we're done! </span>
            <span class="hljs-keyword">if</span>(fn()) {
                callback();
            }
            <span class="hljs-comment">// If the condition isn't met but the timeout hasn't elapsed, go again</span>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Number</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()) &lt; endTime) {
                setTimeout(p, interval);
            }
            <span class="hljs-comment">// Didn't match and too much time, reject!</span>
            <span class="hljs-keyword">else</span> {
                errback(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'timed out for '</span> + fn + <span class="hljs-string">': '</span> + <span class="hljs-built_in">arguments</span>));
            }
    })();
}

<span class="hljs-comment">// Usage:  ensure element is visible</span>
poll(
    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'lightbox'</span>).offsetWidth &gt; <span class="hljs-number">0</span>;
    },
    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">// Done, success callback</span>
    },
    <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">// Error, failure callback</span>
    }
);
</code></pre></div></div><footer class="footer"><address class="author">Copyright &copy; <a rel="author" href="https://github.com/xygcxy" class="author-name">yungeng xu</a>-<a href="https://github.com/xygcxy/my-tech-diary" class="source-repo">Source</a></address><p>Generated by <a href="https://github.com/joyeecheung/diary" class="site-repo">Joyee Cheung&#39;s diary generator</a></p></footer></body></html>